From eed0e212bb2405c8b5ec3d5819639835945733f3 Mon Sep 17 00:00:00 2001
From: Cursor Agent <cursoragent@cursor.com>
Date: Wed, 22 Oct 2025 09:57:55 +0000
Subject: [PATCH 3/7] fix: Critical fixes - magic wand logs, PDF content debug,
 bigger preview
MIME-Version: 1.0
Content-Type: text/plain; charset=UTF-8
Content-Transfer-Encoding: 8bit

FIXES APPLIED:

ü™Ñ 1. MAGIC WAND DEBUGGING
- Added extensive console.log for debugging
- Shows what data is available (processedText, textData)
- Better error message if no content detected
- User sees warning to input text first if empty

üìä 2. PDF GENERATION DEBUGGING
- Added logs to show what content is passed to PDF
- Shows content length and preview
- Fallbacks to ensure no empty values
- Will help diagnose empty PDF issue

üñºÔ∏è 3. ENLARGED & DYNAMIC MARGIN PREVIEW
- Preview size increased from 120px to 240px (2x bigger!)
- Width from 180px to 300px container
- Real-time dynamic updates with transitions
- Shows margin values directly on preview
- Blue for top/bottom margins
- Green for left/right margins
- Simulated chapter text with Lorem ipsum
- Beautiful gradient background
- Much easier to see and understand

‚è∞ 4. TIMERS ALREADY PRESENT
- AITimer component exists and is imported
- Used in cover generation
- Used in illustration generation
- Should display during generation (if slow enough to see)

All builds passing, ready for testing on production!
---
 components/cover-creation.tsx  | 19 ++++++--
 components/export-formats.tsx  | 14 ++++--
 components/layout-template.tsx | 88 +++++++++++++++++++++++-----------
 3 files changed, 86 insertions(+), 35 deletions(-)

diff --git a/components/cover-creation.tsx b/components/cover-creation.tsx
index 4ecb902..078cf9d 100644
--- a/components/cover-creation.tsx
+++ b/components/cover-creation.tsx
@@ -202,6 +202,14 @@ export default function CoverCreation({ illustrations, textData, processedText,
 
   // Fonction pour g√©n√©rer le titre avec l'IA
   const generateTitleWithAI = async () => {
+    console.log('ü™Ñ BAGUETTE CLIQU√âE - D√©but g√©n√©ration titre');
+    console.log('üìä Donn√©es disponibles:', { 
+      hasProcessedText: !!processedText, 
+      hasTextData: !!textData,
+      processedTextLength: processedText?.processedText?.length,
+      textDataLength: textData?.text?.length
+    });
+    
     setIsGeneratingTitle(true);
     setError("");
     setSuccess("");
@@ -214,21 +222,26 @@ export default function CoverCreation({ illustrations, textData, processedText,
       // Priorit√© 1: Texte trait√© par l'IA
       if (processedText && processedText.processedText) {
         contentToSend = processedText.processedText.substring(0, 2000);
+        console.log('‚úÖ Utilisation du texte trait√©:', contentToSend.substring(0, 100));
       }
       // Priorit√© 2: Texte original et chapitres
-      else if (textData) {
+      else if (textData && textData.text) {
         contentToSend = textData.text.substring(0, 2000);
         chaptersToSend = textData.chapters || [];
+        console.log('‚úÖ Utilisation du texte original:', contentToSend.substring(0, 100));
       }
       // Priorit√© 3: Illustrations
       else if (illustrations && illustrations.length > 0) {
         chaptersToSend = illustrations.map(ill => ill.chapterTitle).filter(t => t && t.trim());
         contentToSend = chaptersToSend.join('. ');
+        console.log('‚úÖ Utilisation des illustrations');
       }
       
-      // Si vraiment aucun contenu, utiliser un fallback
+      // Si vraiment aucun contenu, demander √† l'utilisateur
       if (!contentToSend || contentToSend.length < 10) {
-        contentToSend = `Cr√©er un titre cr√©atif et accrocheur pour un ebook de style ${selectedStyle} avec un layout ${selectedLayout}`;
+        setError("‚ö†Ô∏è Aucun contenu d√©tect√©. Veuillez d'abord saisir du texte dans l'√©tape 1.");
+        setIsGeneratingTitle(false);
+        return;
       }
       
       console.log('ü™Ñ G√©n√©ration titre IA - Contenu:', contentToSend.substring(0, 100));
diff --git a/components/export-formats.tsx b/components/export-formats.tsx
index 119167a..87b852d 100644
--- a/components/export-formats.tsx
+++ b/components/export-formats.tsx
@@ -173,16 +173,24 @@ export default function ExportFormats({ layoutSettings, coverData, processedText
         updateProgress()
         
         // Pr√©parer les donn√©es pour le PDF
+        console.log('üìÑ Pr√©paration donn√©es PDF:');
+        console.log('- Titre:', coverData.title);
+        console.log('- Auteur:', coverData.author);
+        console.log('- Contenu length:', processedText?.length || 0);
+        console.log('- Contenu preview:', processedText?.substring(0, 200));
+        
         const ebookData = {
-          title: coverData.title,
-          author: coverData.author,
-          content: processedText,
+          title: coverData.title || 'Mon Ebook',
+          author: coverData.author || 'Auteur',
+          content: processedText || 'Contenu vide',
           backgroundColor: coverData.colors.primary || '#ffffff',
           fontFamily: layoutSettings.typography.bodyFont || 'Georgia',
           hasWatermark: coverData.hasWatermark,
           coverImage: coverData.imageUrl
         }
         
+        console.log('‚úÖ ebookData pr√©par√©:', ebookData.title, 'avec', ebookData.content.length, 'caract√®res');
+        
         currentStep = 2
         updateProgress()
         await new Promise(resolve => setTimeout(resolve, 500))
diff --git a/components/layout-template.tsx b/components/layout-template.tsx
index 512cbc5..868aaad 100644
--- a/components/layout-template.tsx
+++ b/components/layout-template.tsx
@@ -549,58 +549,88 @@ export default function LayoutTemplate({ coverData, processedText, onNext, onBac
                   </div>
                 </div>
                   
-                  {/* Pr√©visualisation visuelle des marges */}
-                  <div className="bg-gray-50 rounded-lg p-4 flex-shrink-0" style={{width: '180px'}}>
-                    <div className="text-xs text-gray-600 mb-2 text-center">Pr√©visualisation</div>
-                    <div className="bg-white border-2 border-gray-300 relative" style={{
-                      width: '120px',
-                      height: '160px',
+                  {/* Pr√©visualisation visuelle des marges - AGRANDIE ET DYNAMIQUE */}
+                  <div className="bg-gradient-to-br from-blue-50 to-purple-50 rounded-xl p-6 flex-shrink-0 border-2 border-blue-200" style={{width: '300px'}}>
+                    <div className="text-sm font-semibold text-gray-700 mb-3 text-center flex items-center justify-center space-x-2">
+                      <span>üìÑ</span>
+                      <span>Pr√©visualisation en temps r√©el</span>
+                    </div>
+                    <div className="bg-white border-4 border-gray-400 relative shadow-lg" style={{
+                      width: '240px',
+                      height: '320px',
                       marginLeft: 'auto',
                       marginRight: 'auto'
                     }}>
-                      {/* Zones de marges color√©es */}
-                      <div className="absolute bg-blue-100 opacity-40" style={{
+                      {/* Zones de marges color√©es avec animations */}
+                      <div className="absolute bg-blue-400 opacity-30 transition-all duration-300" style={{
                         top: 0,
                         left: 0,
                         right: 0,
-                        height: `${(layoutSettings.spacing.margins.top / 40) * 30}%`
-                      }} title={`Haut: ${layoutSettings.spacing.margins.top}mm`}></div>
+                        height: `${(layoutSettings.spacing.margins.top / 40) * 35}%`
+                      }} title={`Marge haute: ${layoutSettings.spacing.margins.top}mm`}>
+                        <div className="text-[10px] font-bold text-blue-900 text-center mt-1">
+                          {layoutSettings.spacing.margins.top}mm
+                        </div>
+                      </div>
                       
-                      <div className="absolute bg-blue-100 opacity-40" style={{
+                      <div className="absolute bg-blue-400 opacity-30 transition-all duration-300" style={{
                         bottom: 0,
                         left: 0,
                         right: 0,
-                        height: `${(layoutSettings.spacing.margins.bottom / 40) * 30}%`
-                      }} title={`Bas: ${layoutSettings.spacing.margins.bottom}mm`}></div>
+                        height: `${(layoutSettings.spacing.margins.bottom / 40) * 35}%`
+                      }} title={`Marge basse: ${layoutSettings.spacing.margins.bottom}mm`}>
+                        <div className="text-[10px] font-bold text-blue-900 text-center absolute bottom-1 w-full">
+                          {layoutSettings.spacing.margins.bottom}mm
+                        </div>
+                      </div>
                       
-                      <div className="absolute bg-blue-100 opacity-40" style={{
+                      <div className="absolute bg-green-400 opacity-30 transition-all duration-300" style={{
                         top: 0,
                         left: 0,
                         bottom: 0,
-                        width: `${(layoutSettings.spacing.margins.left / 40) * 30}%`
-                      }} title={`Gauche: ${layoutSettings.spacing.margins.left}mm`}></div>
+                        width: `${(layoutSettings.spacing.margins.left / 40) * 35}%`
+                      }} title={`Marge gauche: ${layoutSettings.spacing.margins.left}mm`}>
+                        <div className="text-[10px] font-bold text-green-900 transform -rotate-90 absolute left-0 top-1/2 -translate-y-1/2 whitespace-nowrap">
+                          {layoutSettings.spacing.margins.left}mm
+                        </div>
+                      </div>
                       
-                      <div className="absolute bg-blue-100 opacity-40" style={{
+                      <div className="absolute bg-green-400 opacity-30 transition-all duration-300" style={{
                         top: 0,
                         right: 0,
                         bottom: 0,
-                        width: `${(layoutSettings.spacing.margins.right / 40) * 30}%`
-                      }} title={`Droite: ${layoutSettings.spacing.margins.right}mm`}></div>
+                        width: `${(layoutSettings.spacing.margins.right / 40) * 35}%`
+                      }} title={`Marge droite: ${layoutSettings.spacing.margins.right}mm`}>
+                        <div className="text-[10px] font-bold text-green-900 transform rotate-90 absolute right-0 top-1/2 -translate-y-1/2 whitespace-nowrap">
+                          {layoutSettings.spacing.margins.right}mm
+                        </div>
+                      </div>
                       
-                      {/* Zone de contenu */}
-                      <div className="absolute flex items-center justify-center" style={{
-                        top: `${(layoutSettings.spacing.margins.top / 40) * 30}%`,
-                        bottom: `${(layoutSettings.spacing.margins.bottom / 40) * 30}%`,
-                        left: `${(layoutSettings.spacing.margins.left / 40) * 30}%`,
-                        right: `${(layoutSettings.spacing.margins.right / 40) * 30}%`
+                      {/* Zone de contenu avec texte simul√© */}
+                      <div className="absolute flex flex-col justify-start p-2 transition-all duration-300" style={{
+                        top: `${(layoutSettings.spacing.margins.top / 40) * 35}%`,
+                        bottom: `${(layoutSettings.spacing.margins.bottom / 40) * 35}%`,
+                        left: `${(layoutSettings.spacing.margins.left / 40) * 35}%`,
+                        right: `${(layoutSettings.spacing.margins.right / 40) * 35}%`,
+                        backgroundColor: 'rgba(255,255,255,0.9)'
                       }}>
-                        <div className="text-[6px] text-gray-400 leading-tight">
-                          Lorem ipsum dolor sit amet...
+                        <div className="text-[9px] font-bold text-gray-800 mb-1">Chapitre 1</div>
+                        <div className="text-[7px] text-gray-600 leading-tight space-y-1">
+                          <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit.</p>
+                          <p>Sed do eiusmod tempor incididunt ut labore et dolore magna aliqua.</p>
+                          <p>Ut enim ad minim veniam, quis nostrud exercitation.</p>
                         </div>
                       </div>
                     </div>
-                    <div className="text-[10px] text-gray-500 text-center mt-2">
-                      Zones bleues = Marges
+                    <div className="flex items-center justify-center space-x-4 mt-3 text-[11px] text-gray-600">
+                      <div className="flex items-center space-x-1">
+                        <div className="w-3 h-3 bg-blue-400 opacity-40 rounded"></div>
+                        <span>Marges H/B</span>
+                      </div>
+                      <div className="flex items-center space-x-1">
+                        <div className="w-3 h-3 bg-green-400 opacity-40 rounded"></div>
+                        <span>Marges G/D</span>
+                      </div>
                     </div>
                   </div>
                 </div>
-- 
2.48.1

